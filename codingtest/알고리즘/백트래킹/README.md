# 백트래킹(backtracking)

## 백 트래킹 이란?

* 백트래킹 또는 퇴각 검색이라고 한다.
* **제약 조건 만족 문제**에서 답을 찾기 위한 전략 중 하나이다.
    - 답을 찾기위해, 후보군에 제약조건을 점진적으로 체크하다가, 해당 후보군이 제약조건을 만족하지 않을 경우 백트래킹(다시는 이 후보군을 체크하지 않을것)하고, 다른 후보군으로 넘어가며, 최적의 해를 찾는 방법
* 실제 구현시, 고려할 수 있는 모든 경우의 수를 상태공간트리를 통해 표현한다.
    - 각 후보군을 DFS방식으로 확인한다.
    - 상태 공간 트리를 탐색하면서, 제약이 맞지 않으면 답의 후보가 될만한 곳으로 바로 넘어가서 탐색한다.
        * Promising : 해당 루트가 조건에 맞는지를 검사하는 기법
        * Pruning(가지치기) : 조건에 맞지 않으면 포기하고 다른 루트로 바로 돌아서서, 탐색의 시간을 절약하는 기법

> 백 트래킹은 트리 구조를 기반으로 DFS로 탐색을 하면서, 각 루트에 대해 조건에 부합하는지 체크한다.(Promising) 만약 해당 트리에서 조건에 맞지않는 노드는 더이상 DFS로 탐색하지 않고 Pruning한다.

### 상태 공간 트리란? (State Space Tree)

* 문제 해결 과정의 중간 상태를 각각의 노드로 나타낸 트리이다.
    
    <img src="https://www.fun-coding.org/00_Images/statespacetree.png" width=300>

## 백 트래킹을 활용한 문제

## N Queen 문제
* 대표적인 백트래킹 문제
* NxN 크기의 체스판에 N개의 퀸을 서로 공격할 수 없도록 배치하는 문제이다.
* 퀸은 다음과 같이 이동할 수 있으므로, 배치된 퀸 간에 공격할 수 없는 위치로 배치해야한다.

<img src="https://www.fun-coding.org/00_Images/queen_move.png">

### Pruning(가지치기) for N Queen 문제
* 한 행에는 하나의 퀸 밖에 위치할 수 없다 (퀸은 수평이동이 가능하기 때문에)
* 맨 위에 있는 행부터 퀸을 배치하고, 다음 행에 해당 퀸이 이동할 수 없는 위치를 찾아 퀸을 배치한다.
* 만약 앞선 행에 배치한 퀸으로 인해, 다음 행에 다음 퀸을 배치할 수 없는 경우 더 이상 퀸을 배치하지 않고, 이전 행의 퀸의 배치를 바꾼다.

<img src="https://www.fun-coding.org/00_Images/backtracking.png">

### Promising for N Queen 문제
* 해당 루트가 조건에 맞는지를 검사하는 기법을 활용한다.
* 현재까지 앞선 행에서 배치한 퀸이 이동할 수 없는 위치가 있는지를 다음과 같은 조건으로 확인한다.
    - 한 행에 어차피 하나의 퀸만 배치 가능하므로 수평 체크는 별도로 필요하지 않다.
      <img src="https://www.fun-coding.org/00_Images/nqueen.png">


### N Queen 문제 파이썬 코드 작성

```python
def 조건(후보리스트, 열번호):
    행번호 = len(후보리스트)
    for 퀸이있는행 in range(행번호):
        if 후보리스트[퀸이있는행] == 열번호 or abs(후보리스트[퀸이있는행] - 열번호) == 행번호 - 열번호:
            return False
        return True


def DFS(퀸개수, 행번호, 후보리스트, 답리스트):
    if 행번호 == 퀸개수:
        답리스트.append(후보리스트[:])
        return
    for 열번호 in range(퀸개수):
        if 조건(후보리스트, 열번호):
            후보리스트.append(열번호)
            DFS(퀸개수, 행번호+1, 후보리스트, 답리스트)
            후보리스트.pop()

def nQueen(퀸개수):
    답리스트 = []
    DFS(퀸개수, 0, [], 답리스트)
    return 답리스트
```
```python
nQueen(4)
#출력
출력 > [[1, 3, 0, 2], [2, 0, 3, 1]]
```